{"ast":null,"code":"var _jsxFileName = \"/Users/andrea/Desktop/ITS Prodigi/Seacom/Application/Todo/Full Stack ToDo login 1.1 copia/client/src/components/Register.js\",\n  _s = $RefreshSig$();\nimport { GoogleLogin, GoogleOAuthProvider } from '@react-oauth/google';\nimport jwt_decode from 'jwt-decode';\nimport { useState, useEffect } from 'react';\nimport './components.css';\nimport { useNavigate } from 'react-router-dom';\nimport { gql, useMutation } from '@apollo/client';\nimport client from '../index';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Login() {\n  _s();\n  const navigate = useNavigate();\n  const [addUserMutation] = useMutation(CREATE_USER);\n  const [currentUserToken, setCurrentUserToken] = useState(null);\n  const [currentUserName, setCurrentUserName] = useState(null);\n  const [currentUserImg, setCurrentUserImg] = useState(null);\n  const [isRegistered, setIsRegistered] = useState(false);\n  useEffect(() => {\n    console.log('user:' + currentUserToken);\n  }, []);\n  function NavigateTo() {\n    navigate('/Register');\n  }\n  const handleSuccess = async credentialResponse => {\n    var decoded = jwt_decode(credentialResponse.credential);\n    const token = decoded.sub;\n    const {\n      data\n    } = await client.query({\n      query: CHECK_USER,\n      variables: {\n        token: token\n      }\n    });\n    console.log(data);\n    if (!data.CheckUser) {\n      await addUserMutation({\n        variables: {\n          token: token,\n          name: decoded.name,\n          email: decoded.email\n        },\n        update(cache, _ref) {\n          let {\n            data\n          } = _ref;\n          const newUserData = {\n            _id: data.newUser._id,\n            userName: data.newUser.userName\n          };\n          console.log(data);\n          const updated = {\n            CheckUser: {\n              ...data.CheckUser,\n              ...newUserData\n            }\n          };\n          client.writeQuery({\n            query: CHECK_USER,\n            variables: {\n              token: token\n            },\n            data: updated\n          });\n        }\n      });\n      localStorage.setItem('currentUser', JSON.stringify(decoded.sub));\n      localStorage.setItem('currentUserName', JSON.stringify(decoded.given_name));\n      localStorage.setItem('currentUserImg', JSON.stringify(decoded.picture));\n      navigate('/');\n    } else {\n      setIsRegistered(true);\n    }\n  };\n  if (isRegistered) {\n    return /*#__PURE__*/_jsxDEV(\"main\", {\n      className: \"loginpage\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          children: \"Mhh...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"This account seems to be registered already\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          children: [\"Move to \", /*#__PURE__*/_jsxDEV(\"a\", {\n            href: \"#\",\n            className: \"redirectRegister\",\n            onClick: NavigateTo,\n            children: \"Login Page!\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 74,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 74,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 9\n    }, this);\n  } else {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"signInButton\",\n      style: {\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center'\n      },\n      children: /*#__PURE__*/_jsxDEV(GoogleOAuthProvider, {\n        clientId: \"1038509275601-a2gf0vtu5pt81as8586gt0hsqrqis0mh.apps.googleusercontent.com\",\n        children: /*#__PURE__*/_jsxDEV(GoogleLogin, {\n          onSuccess: handleSuccess,\n          onError: handleError\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 82,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 9\n    }, this);\n  }\n}\n_s(Login, \"Hu1AibNlD1kGx5+040XROkuUaUA=\", false, function () {\n  return [useNavigate, useMutation];\n});\n_c = Login;\nvar _c;\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"names":["GoogleLogin","GoogleOAuthProvider","jwt_decode","useState","useEffect","useNavigate","gql","useMutation","client","jsxDEV","_jsxDEV","Login","_s","navigate","addUserMutation","CREATE_USER","currentUserToken","setCurrentUserToken","currentUserName","setCurrentUserName","currentUserImg","setCurrentUserImg","isRegistered","setIsRegistered","console","log","NavigateTo","handleSuccess","credentialResponse","decoded","credential","token","sub","data","query","CHECK_USER","variables","CheckUser","name","email","update","cache","_ref","newUserData","_id","newUser","userName","updated","writeQuery","localStorage","setItem","JSON","stringify","given_name","picture","className","children","fileName","_jsxFileName","lineNumber","columnNumber","href","onClick","id","style","display","justifyContent","alignItems","clientId","onSuccess","onError","handleError","_c","$RefreshReg$"],"sources":["/Users/andrea/Desktop/ITS Prodigi/Seacom/Application/Todo/Full Stack ToDo login 1.1 copia/client/src/components/Register.js"],"sourcesContent":["import { GoogleLogin, GoogleOAuthProvider } from '@react-oauth/google';\nimport jwt_decode from 'jwt-decode';\nimport { useState, useEffect } from 'react';\nimport './components.css';\nimport { useNavigate } from 'react-router-dom';\nimport  {gql,useMutation} from '@apollo/client'\nimport client from '../index'\n\n\n\nexport default function Login() {\n    const navigate = useNavigate();\n    const [addUserMutation] = useMutation(CREATE_USER);\n    const [currentUserToken, setCurrentUserToken] = useState(null);\n    const [currentUserName, setCurrentUserName] = useState(null);\n    const [currentUserImg, setCurrentUserImg] = useState(null);\n    const [isRegistered, setIsRegistered] = useState(false); \n  \n    useEffect(() => {\n      console.log('user:' + currentUserToken);\n    }, []);\n  \n    function NavigateTo() {\n      navigate('/Register');\n    }\n  \n    const handleSuccess = async (credentialResponse) => {\n      var decoded = jwt_decode(credentialResponse.credential);\n      const token = decoded.sub;\n      const { data } = await client.query({\n        query: CHECK_USER,\n        variables: { token: token }\n      });\n      console.log(data);\n      if (!data.CheckUser) {\n        await addUserMutation({\n          variables: {\n            token: token,\n            name: decoded.name,\n            email: decoded.email\n          },\n          update(cache, { data }) {\n            const newUserData = {\n              _id: data.newUser._id,\n              userName: data.newUser.userName,\n            }\n            console.log(data);\n            const updated = {\n              CheckUser: { ...data.CheckUser, ...newUserData }\n            };\n  \n            client.writeQuery({\n              query: CHECK_USER,\n              variables: { token: token },\n              data: updated\n            });\n          }\n        });\n        localStorage.setItem('currentUser', JSON.stringify(decoded.sub));\n        localStorage.setItem('currentUserName', JSON.stringify(decoded.given_name));\n        localStorage.setItem('currentUserImg', JSON.stringify(decoded.picture));\n        navigate('/');\n      } else {\n        setIsRegistered(true);\n      }\n    };\n  \n    if (isRegistered) {\n      return (\n        <main className='loginpage'>\n          <div>\n            <h1>Mhh...</h1>\n            <h2>This account seems to be registered already</h2>\n            <h2>Move to <a href=\"#\" className='redirectRegister' onClick={NavigateTo}>Login Page!</a></h2>\n          </div>\n        </main>\n      );\n    } else {\n      return (\n        <div id=\"signInButton\" style={{ display: 'flex', justifyContent: 'center', alignItems: 'center' }}>\n          <GoogleOAuthProvider clientId=\"1038509275601-a2gf0vtu5pt81as8586gt0hsqrqis0mh.apps.googleusercontent.com\">\n            <GoogleLogin onSuccess={handleSuccess} onError={handleError} />\n          </GoogleOAuthProvider>\n        </div>\n      );\n    }\n  }\n  "],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}