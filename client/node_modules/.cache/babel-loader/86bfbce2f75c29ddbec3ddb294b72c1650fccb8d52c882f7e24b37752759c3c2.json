{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useNavigate } from 'react-router-dom';\nimport { CHECK_USER, GET_TASKS, DELETE_USER } from '../../queries/query';\nimport { useQuery, useMutation } from '@apollo/client';\nconst currentUserToken = JSON.parse(localStorage.getItem('currentUser'));\nconst currentUserName = JSON.parse(localStorage.getItem('currentUserName'));\nasync function HandleDeleteAccount() {\n  _s();\n  const [deleteUserMutation] = useMutation(DELETE_USER);\n  const {\n    data: tasksData\n  } = useQuery(GET_TASKS, {\n    variables: {\n      token: currentUserToken,\n      userName: currentUserName\n    }\n  });\n  const navigate = useNavigate();\n  const taskIds = tasksData.tasks.map(task => task.id);\n  const token = currentUserToken;\n  deleteUserMutation({\n    variables: {\n      token: currentUserToken,\n      id: taskIds\n    },\n    update: cache => {\n      cache.writeQuery({\n        query: CHECK_USER,\n        variables: {\n          token: token\n        },\n        data: {\n          CheckUser: {}\n        }\n      });\n      cache.writeQuery({\n        query: GET_TASKS,\n        variables: {\n          token: currentUserToken,\n          userName: currentUserName\n        },\n        data: {\n          tasks: []\n        }\n      });\n    }\n  });\n  localStorage.setItem('currentUser', JSON.stringify(null));\n  localStorage.setItem('currentUserName', JSON.stringify(null));\n  localStorage.setItem('currentUserImg', JSON.stringify(null));\n  navigate('/login');\n}\n_s(HandleDeleteAccount, \"aZleJpS3oaR5JAbLTw4KSIyLg4Q=\", false, function () {\n  return [useMutation, useQuery, useNavigate];\n});\n_c = HandleDeleteAccount;\nexport default HandleDeleteAccount;\nvar _c;\n$RefreshReg$(_c, \"HandleDeleteAccount\");","map":{"version":3,"names":["useNavigate","CHECK_USER","GET_TASKS","DELETE_USER","useQuery","useMutation","currentUserToken","JSON","parse","localStorage","getItem","currentUserName","HandleDeleteAccount","_s","deleteUserMutation","data","tasksData","variables","token","userName","navigate","taskIds","tasks","map","task","id","update","cache","writeQuery","query","CheckUser","setItem","stringify","_c","$RefreshReg$"],"sources":["/Users/andrea/Desktop/ITS Prodigi/Seacom/Application/Todo/Full Stack ToDo login elasticEmongo/client/src/components/functions/HandleDeleteAccount.js"],"sourcesContent":["import { useNavigate } from 'react-router-dom';\nimport { CHECK_USER,GET_TASKS,DELETE_USER } from '../../queries/query';\nimport {useQuery,useMutation} from '@apollo/client'\n\nconst currentUserToken = JSON.parse(localStorage.getItem('currentUser'));\nconst currentUserName = JSON.parse(localStorage.getItem('currentUserName'));\n\n\nasync function HandleDeleteAccount(){\n    const [deleteUserMutation] = useMutation(DELETE_USER)\n    const { data: tasksData } = useQuery(GET_TASKS,{    \n      variables: {\n      token: currentUserToken,\n      userName: currentUserName\n    }\n    });\n\n    const navigate = useNavigate();\n    const taskIds = tasksData.tasks.map((task) => task.id);\n    const token = currentUserToken\n\n    deleteUserMutation({\n      variables: {\n        token: currentUserToken,\n        id: taskIds\n      },\n      update: (cache) => {\n        cache.writeQuery({\n          query: CHECK_USER,\n          variables: {token:token},\n          data: { CheckUser: {} },\n        });\n        cache.writeQuery({\n          query: GET_TASKS,\n          variables: {\n            token: currentUserToken,\n            userName: currentUserName\n          },\n          data: { tasks: [] }, \n        });\n      },\n    })\n    localStorage.setItem('currentUser', JSON.stringify(null));\n    localStorage.setItem('currentUserName', JSON.stringify(null));\n    localStorage.setItem('currentUserImg', JSON.stringify(null));\n    navigate('/login')\n  }\n\n\n  export default HandleDeleteAccount"],"mappings":";AAAA,SAASA,WAAW,QAAQ,kBAAkB;AAC9C,SAASC,UAAU,EAACC,SAAS,EAACC,WAAW,QAAQ,qBAAqB;AACtE,SAAQC,QAAQ,EAACC,WAAW,QAAO,gBAAgB;AAEnD,MAAMC,gBAAgB,GAAGC,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC,CAAC;AACxE,MAAMC,eAAe,GAAGJ,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,iBAAiB,CAAC,CAAC;AAG3E,eAAeE,mBAAmBA,CAAA,EAAE;EAAAC,EAAA;EAChC,MAAM,CAACC,kBAAkB,CAAC,GAAGT,WAAW,CAACF,WAAW,CAAC;EACrD,MAAM;IAAEY,IAAI,EAAEC;EAAU,CAAC,GAAGZ,QAAQ,CAACF,SAAS,EAAC;IAC7Ce,SAAS,EAAE;MACXC,KAAK,EAAEZ,gBAAgB;MACvBa,QAAQ,EAAER;IACZ;EACA,CAAC,CAAC;EAEF,MAAMS,QAAQ,GAAGpB,WAAW,CAAC,CAAC;EAC9B,MAAMqB,OAAO,GAAGL,SAAS,CAACM,KAAK,CAACC,GAAG,CAAEC,IAAI,IAAKA,IAAI,CAACC,EAAE,CAAC;EACtD,MAAMP,KAAK,GAAGZ,gBAAgB;EAE9BQ,kBAAkB,CAAC;IACjBG,SAAS,EAAE;MACTC,KAAK,EAAEZ,gBAAgB;MACvBmB,EAAE,EAAEJ;IACN,CAAC;IACDK,MAAM,EAAGC,KAAK,IAAK;MACjBA,KAAK,CAACC,UAAU,CAAC;QACfC,KAAK,EAAE5B,UAAU;QACjBgB,SAAS,EAAE;UAACC,KAAK,EAACA;QAAK,CAAC;QACxBH,IAAI,EAAE;UAAEe,SAAS,EAAE,CAAC;QAAE;MACxB,CAAC,CAAC;MACFH,KAAK,CAACC,UAAU,CAAC;QACfC,KAAK,EAAE3B,SAAS;QAChBe,SAAS,EAAE;UACTC,KAAK,EAAEZ,gBAAgB;UACvBa,QAAQ,EAAER;QACZ,CAAC;QACDI,IAAI,EAAE;UAAEO,KAAK,EAAE;QAAG;MACpB,CAAC,CAAC;IACJ;EACF,CAAC,CAAC;EACFb,YAAY,CAACsB,OAAO,CAAC,aAAa,EAAExB,IAAI,CAACyB,SAAS,CAAC,IAAI,CAAC,CAAC;EACzDvB,YAAY,CAACsB,OAAO,CAAC,iBAAiB,EAAExB,IAAI,CAACyB,SAAS,CAAC,IAAI,CAAC,CAAC;EAC7DvB,YAAY,CAACsB,OAAO,CAAC,gBAAgB,EAAExB,IAAI,CAACyB,SAAS,CAAC,IAAI,CAAC,CAAC;EAC5DZ,QAAQ,CAAC,QAAQ,CAAC;AACpB;AAACP,EAAA,CAtCYD,mBAAmB;EAAA,QACDP,WAAW,EACZD,QAAQ,EAOnBJ,WAAW;AAAA;AAAAiC,EAAA,GATjBrB,mBAAmB;AAyChC,eAAeA,mBAAmB;AAAA,IAAAqB,EAAA;AAAAC,YAAA,CAAAD,EAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}